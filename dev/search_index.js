var documenterSearchIndex = {"docs":
[{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"One idea with the HARMONIE verification packages is that it should be easy to share you results with others. This is where WebgraF comes in. It was originally written to mimic the ECMWF \"chart\" facility like here. The ECMWF solution is a perl based server solution and needs some installation and WebgraF is a javascript running locally which makes it more portable. The idea with WebgraF is that each page is defined by a simple definition file which spans the space of the menu axes on the page. ","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Examples :","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"GLAMEPS Definition file\nDaily maps Definition file","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"At the end of both of the scripts Runverobssurface/Runverobstemp there is a call to Create_ver_js.pl that builds the webpage depending on your configuration file. It is also possible to (re)generate the webpage directly by running:","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Create_ver_js YOUR_CONFIG_FILE","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"The WebgraF page is controlled by the WebgraF script. It has commands to e.g. list, add, remove the content of a page. To start mastering your own page you first have to let the script know the location of the page by setting the environment variable WEBGRAF_BASE ","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"# in bash\nexport WEBGRAF_BASE=SOME_PATH/monitor/WebgraF\n# or in tcsh\nsetenv WEBGRAF_BASE SOME_PATH/monitor/WebgraF","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Now you can list the content of you page by","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"WebgraF/bin/WebgraF -l ","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"A more comprehensive list of commands can be found in the README file. The rules and functions available for your definition file is found here.","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Two useful tools is the export and transport commands. Both creates an portable extraction of your verification page but in two different ways.","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"The export.tar file is a stand alone web page that you can untar anywhere and open in your browser.\nThe transport.tar file is suitable to add to an already existing WebgraF page by  WebgraF -a TARFILE","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Both are accessible through the script Transport_ver which is used like","category":"page"},{"location":"webgraf/#","page":"WebgraF","title":"WebgraF","text":"Transport_ver YOUR_CONFIG_FILE","category":"page"},{"location":"webgraf2/#Install-1","page":"Install","title":"Install","text":"","category":"section"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"Set your WebgraF main directory in WebgraF/bin/WebgraF.pl where :\nTell WebgraF where you have installed it by exporting the environment variable WEBGRAF_BASE = \"$SOME_FULL_PATH/WebgraF\"\nAdd $SOME_FULL_PATH/WebgraF/bin/WebgraF to you path","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"Open $SOME_FULL_PATH/WebgraF/index.html in you browser","category":"page"},{"location":"webgraf2/#Basic-usage-1","page":"Install","title":"Basic usage","text":"","category":"section"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"```bash  WebgraF -h will print :","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"USAGE: WebgraF -p PROJECT -e ENTRY [ -f FILE ] [ -glrhxXInmatuci ]  ","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"-h Displays this help   -l List all projects and entrys   -b Work with a different base directory   -p PROJECT name   -e ENTRY name   -r Remove ENTRY or PROJECT   -n Rename PROJECT/ENTRY    -f FILE. Add WebgraF page definition file or directory      can be FILE.js,FILE.tar or directory   -g Get input.js from PROJECT/ENTRY   -x Export an PROJECT/ENTRY as a tar file     This file can be opened as a stand alone web page  -t Transport an PROJECT/ENTRY      Creates a XXX___transport.tar file  -a Add a file extracted with -t   -I Install a new WebgraF webhome, to be used with -b   -i INFO html file linked to project or entry   -j Set host page for main page like: WebgraF -j https://hirlam.org   -m Message on PROJECT link   -c CLEANAGE Remove all ( but .html,.js) files older than CLEANAGE days from PROJECT/ENTRY   -u Add user name to an entry   ```","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -l will list current projects","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF will print list + help","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -p PROJECT_1 -e RAOBCORE -g will give you the file definition for PROJECT_1/RAOBCORE","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -p PROJECT_1 -i -g will give you the project description PROJECT_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -I \"My WebgraF\" will install a new WebgraF home directory with title \"My WebgraF\"","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"Open $FULL_PATH/NEW_WEBGRAF/index.html in your browser","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -f PROJECT_1_RAOBCORE.js will create new project/entry PROJECT_1/ENTRY_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -i \"http://www.smhi.se\"  will add a new description on PROJECT_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -f fig.tar will new plots to PROJECT_1/ENTRY_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -x will create a tar file with your plots and definition for ENTRY_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1            -x will create a tar file with your plots and definition for PROJECT_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -c 0 will list all png/gif files in ENTRY_1","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -c 10 will remove alla png/gif older than 10 days","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -m \"Some info\" will add some text to the main page","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -e ENTRY_1 -n ENTRY_2  will rename PROJECT_1/ENTRY_1 to PROJECT_1/ENTRY_2","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_1 -n PROJECT_2  will rename PROJECT_1 to PROJECT_2","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_2 -e ENTRY_2 -r will remove entry ENTRY_2","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_2 -r will remove project PROJECT_2","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_2 -t will create a PROJECT2___transport.tar file","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"WebgraF -b $FULL_PATH/NEW_WEBGRAF -p PROJECT_3 -a PROJECT2___transport.tar file will create a new project using the tar file as input","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"These are the most (un)useful commands in WebgraF","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"For a description of the options in the entry definition javascript file click INFO on the main page   and then FILE.js in the description.","category":"page"},{"location":"webgraf2/#","page":"Install","title":"Install","text":"Good Luck!","category":"page"},{"location":"#Monitor-1","page":"Monitor","title":"Monitor","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"(Image: )","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The verification package in HARMONIE is designed to be a self contained stand alone package dealing with pre-extracted model and observational data. The package calculates several standard verification scores such as:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Error as function of forecast lead time summarises the bias and rms error and their growth rate over a set of forecasts\nTime sequences and vertical profiles show how your data or error characteristic is distributed in time or in the vertical\nError charts and tables show how some error is distributed in space, and station wise linear correlation\nScatter plots show the correspondence between forecast and observed values\nMean diurnal cycles show how your mean error changes in the course of the day\nHistograms show the correspondence between the distributions of forecast and observed values\nStudent t-test to show how reliable differences between different experiments are","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"In addition there are a number of scores based on contingency tables like:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"score description Range Perfect Score\nFrequency bias (bias score) (h+fa)(h+m); Compares the frequency of predicted events to the frequency of observed events  0  ) 1\nHit rate (probability of detection) h(h+m); What fraction of the observed events were correctly forecast 0 1 1\nFalse alarm ratio fa(h+fa); What fraction of the predicted events did not occur 0 1 0\nFalse alarm rate fa((cn+fa); What fraction of the observed \"no\" events were incorrectly forecast as \"yes\" 0 1 0\nThreat score h(h+m+fa); How well did the forecast \"yes\" events correspond to the observed \"yes\" events. 0 1 1\nThe Equitable threat score takes into account the number of random hits (R) and is less sensitive to climatology: ETS=(hR)(h+m+faR),  R=(h+m)(h+fa)(h+m+fa+cn). Often used in verification of precipitation. -⅓ 1 1, 0=no skill\nHansen­Kuipers score (h(h+m) ­fa(fa+cn)), How well did the forecast separate events from non­events. -1 1 `1, 0 = no skill\nExtreme Dependency Scores What is the association between forecast and observed rare events? -1 1 1, 0 = no skill","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"A more detailed explanation about verification can found here","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The scores can be presented per station for the whole data set or filtered through different selection criteria based on e.g. a geographical domain or properties of the data itself. One key feature missing in earlier HIRLAM verification packages is that the comparison is done over exactly the same set of data ( in time and space ) when comparing different experiments or models. The scores are finally presented with a portable web interface, WebgraF, that allows you to easily share the information with others. Since the verification is station based it is less suitable for moving platforms or fields.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Other examples on how products from the verification package looks like today can be found here:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The monitor test data set\nFMI\nMast verification\nHIRLAM verification portal ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"In the following we describe the different parts of the verification package. For preparation of verification data read more here.","category":"page"},{"location":"#Getting-and-compiling-the-code-1","page":"Monitor","title":"Getting and compiling the code","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"The verification code can be fetched from the hirlam code repository by","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"git clone https://github.com/Hirlam/monitor\ncd monitor","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Optionally checkout a specific version (for ARCH=linuxgfortran use the master branch instead)","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"git checkout v1.1","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The checkout gives you the following directories:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Directory Description\ncmastat for assimilation monitoring, not covered here\nconfig configuration files for different platforms\ndoc README files\nmod Different modules. module_data.f90 contains all namelist variables\nprg Main programs\nrdr Routines for reading data\nscr Scripts\nsrc The hard core verification routines\ntools Compilation tools\nWebgraF The web interface","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"You compile by finding the appropriate configuration file for your platform and type","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"gmake ARCH=YOUR_ARCH","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The package has no external dependencies but relies on gnuplot for generation of the graphics.","category":"page"},{"location":"#The-verification-step-by-step-1","page":"Monitor","title":"The verification step by step","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"The strategy in the verification is to separate the data input from the calculations of the different scores. This allows as to go through the data several times using different filtering criteria. Of course keeping everything in memory sets a limit on how much data one can handle at the same time. In the way it's used in HARMONIE a typical sequence is:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Read namelist\nCall my_choices\nRead observations\nRead model data\nPerform quality control\nLoop over all namelists\nSelection of data \nCalculate the scores and write data\nCheck for new namelist","category":"page"},{"location":"#Reading-the-data-1","page":"Monitor","title":"Reading the data","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"The program can handle several data sources. Which one you use is depending on the value of DATA_SOURCE and is controlled in the routine my_choices.f90. At namelist level we also control which experiments we should read, the period (SDATE,EDATE), interval between cycles (FCINT), which forecasts (FCLEN) and the interval of the observations (OBINT). We can also already at this point select which stations to use by specifying a station list (STNLIST). ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The HARMONIE tools to extract data for verifiation are described in here.","category":"page"},{"location":"#A-general-input-format-1","page":"Monitor","title":"A general input format","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"For the every day verification the model and observation data are read with the routines ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"read_vfld.f90\nread_vobs.f90\nread_vfld_temp.f90\nread_vobs_temp.f90","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Where the two first are for surface data and are used when DATA_SOURCE=vfld and the two latter for temp data and are used when DATA_SOURCE=vfld_temp. During the evolution of the verification package the format of the input data has changed and we are now at version four. The new format allows an arbitrary number of different types of point data to be included in the model vfld- or observation vobs- files.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The generalized input format is defined as ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"nstation_synop nstation_temp version_flag  # written in fortran format '(1x,3I6)' )\n# where version_flag == 4\n# If ( nstation_synop > 0 ) we read the variables in the file, their descriptors and\n# their accumulation time\n#\nnvar_synop\nDESC_1 ACC_TIME_1\n...\nDESC_nvar_synop ACC_TIME_nvar_synop\n# Station information and data N=nstation_synop times\nstid_1 lat lon hgt val(1:nvar_synop)\n...\nstid_N lat lon hgt val(1:nvar_synop)\n\n# If ( nstation_temp > 0 )\nnlev_temp\nnvar_temp\nDESC_1 ACC_TIME_1\n..\nDESC_nvar_temp ACC_TIME_nvar_temp\n# Station information and data nstation_temp times\n# and station data nlev_temp times for each station\nstid_1 lat lon hgt\npressure(1) val(1:nvar_temp)\n...\npressure(nlev_temp) val(1:nvar_temp)\nstid_2 lat lon hgt\n...","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The accumulation time allows us to e.g. easily include different precipitation accumulation intervals. Any variable can be included in the file and verified without any code changes. Once you have defined a variable in your data you have to describe its properties in the plotdefs.pm described in the [#Settingsfordifferentmeteorologicalparameters parameter setting section].","category":"page"},{"location":"#Quality-control-1","page":"Monitor","title":"Quality control","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"The quality control is activated by the namelist flag LQUALITY_CONTROL. It is mainly there as a gross error check to remove the unrealistic observations. The check has the following features:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The forecast lengths used for quality control can be set by namelist variable QC_FCLEN. If QC_FCLEN is not set The forecasts < FORECAST_INTERVAL will be used.\nAn observation is accepted if ABS(mod - exp) < err_limit for ANY experiment used in the verification. \nThe quality control limits can be set explicitly in namelist by VARPROP%LIM for any variable or by QC_LIM for all variables. See the section about [ #Settingsfordifferentmeteorologicalparameters parmeter settings] for further instructions.\nBy setting ESTIMATE_QC_LIMIT the QC_LIM will be set as SCALE_QC_LIM * STDV for the forecasts in QC_FCLEN.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"QC diagnostic information output may be controlled by PRINT_QC={0,1,2}. It is also possible to blacklist stations through the STNLIST_BL parameter.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"In the HARMONIE implementation all quality control levels are estimated on the fly with a limit where the standard deviation is scaled by 5.","category":"page"},{"location":"#The-selection-process-1","page":"Monitor","title":"The selection process","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"Before we run through the actual comparison of data we can select a subset of the data depending on different criteria.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Initial time of the forecast (INI_HOURS)\nSelect data that are valid at a certain hour (SHOW_TIMES) \nPick only some of the forecast lengths in memory (USE_FCLEN)\nSelection using a station list (STNLIST)\nSelect to produce statistics for some selected stations in addition to the overall statistics (STNLIST_PLOT)\nDefine a geographical box through the definition of the corners (CBOX%ACTIVE,CBOX%S,CBOX%W,CBOX%N,CBOX%E).\nUse an area defined by a polygon (LPOLY,POLYFILE)\nSelect by station height (HGT_LLIM,HGT_ULIM)\nConditions given by the data (described later)\nReverse all selections but the conditional (REVERSE_SELECTION)","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Of course all the selections can be combined.","category":"page"},{"location":"#The-verification-loop-1","page":"Monitor","title":"The verification loop","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"For each station we loop over all selected stations, initial times, forecast lengths for the given period and accumulate the statistics. Data is stored by:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Statistic by forecast length or time of day, for each station and accumulated for all stations and is used to generate error maps(MAP), vertical profiles(VERT), standard forecast length verification(GEN) and daily variation scores (DAYVAR)\nTime serie arrays for each station and accumulated for all stations (TIME)\nOne array containing all the selected data used for scatter plots (SCAT) and contingency table calculations (CONT). From the contingency table we can calculate several different scores described later.","category":"page"},{"location":"#Output-format-1","page":"Monitor","title":"Output format","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"Early versions of the package was based on the ECMWF graphics package MAGICS. Due to the poor portability of MAGICS the package now a days produces text files that are parsed through a script that produces plots using gnuplot. It may not be the most elegant graphics package, but it is available almost everywhere. Some verification are also produced in form of tables. The contingency tables are parsed through contingency2gnuplot.pl to produce skill scores.","category":"page"},{"location":"#HARMONIE-user-interface-1","page":"Monitor","title":"HARMONIE user interface","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"In HARMONIE a set of scripts is build around the code for generation of plots and building the web page. ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"There are two main scripts  Run_verobs_surface](https://github.com/Hirlam/Monitor/tree/master/scr/Runverobssurface)  for verification of surface variables and Run_verobs_temp](https://github.com/Hirlam/Monitor/tree/master/scr/Runverobstemp)  for verification of radio sonde data. Both of them need a configuration file, Env_exp, as input:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"./Run_verobs_surface MY_ENV_EXP\n./Run_verobs_temp MY_ENV_EXP","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"There is also a master script Run_verobs_all which cleans the webpage, runs through both types of verification and creates a tar file suitable to add to an existing WebgraF page. It is used in the same way like:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"./Run_verobs_all MY_ENV_EXP","category":"page"},{"location":"#The-main-configuration-file-1","page":"Monitor","title":"The main configuration file","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"For most of the cases you can configure your verification by just editing the configuration file, Env_exp. The above mentioned script can take files with any name so it's a good idea to have different files for different sets of experiments. First you have to identify your experiments and their location. ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Experiment names and paths,should be space separated\nDBASE=/scratch/ms/dk/nhz/oprint\nEXP=\"RCR C22\"\nDISPLAY_EXP=\"$EXP\"\nOBSPATH=$DBASE/OBS2/\nP1=$DBASE/RCR/\nP2=$DBASE/C22/\nMODPATH=\"$P1 $P2\"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The experiment name should of course match the name on the vfld files. At the moment there is an upper limit of ten experiments, but already at five the plots starts to get pretty messy. It is possible to disply more meaningful names by setting DISPLAY_EXP to something different.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"From harmonie-40h1.1.1.rc1 the output from the verification for the initial setup has changed so that ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"vfldEXPYYYYMMDDHH represents analysis data\nvfldEXPYYYYMMDDHHLL represents output from the forecast model at +00","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"To handle this USE_ANALYSIS has been introduced to allow different choices and combination of the new and old convention.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Use analysis at +00h, set per experiment\nUSE_ANALYSIS=\".FALSE.,.TRUE.,.FALSE.,.TRUE.,.TRUE.\"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"We should now defined the name on the WebgraF page and write some text ( in simple html syntax ) describing the experiments.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Project name, will be the name on the web page\nPROJECT=monitor\n\n# Explanation on webpage\nHELP=\"Observation verification comparison between \\\n      <br> FMI(RCR) \\\n      <br> SMHI(C22) \\\n     \"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"By having several configuration files with different PROJECT names you can gather all your verification plots under one web page. In next section we define the verification period. We can also say if we would like to verify the full period in one go or in monthly pieces by setting PERIOD_TYPE.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Date handling\n# PERIOD_TYPE 1 : SDATE - EDATE,\n#             2 : SDATE - EDATE in monthly pieces\n#\n# IDATE is the very first date for PERIOD_TYPE=2 it determines the\n# lentgh of the date menu in WebgraF\n#\nPERIOD_TYPE=1\n\nSDATE=20080901\nEDATE=20080905\nIDATE=$SDATE","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"For operational runs it might be useful to set PERIOD_TYPE=2 like FMI has done.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"If you would like to monitor some special stations you can list them by station number.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"#\n# Single stations can be defined with comma separated\n# station number and a text for the web page\n#\n# STNLIST_PLOT=\"00002574,00006348\"\n# STNLIST_PLOT_TXT=\"NORRKOPING,CABAUW\"\n#\nSTNLIST_PLOT=-1\nSTNLIST_PLOT_TXT=-1","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Note that the zeros in the name matters since the plots are created with station id as eight digit numbers. A list of parameters to be verified are selected through SURFPAR and TEMPPAR respectively. ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"######################\n# Surface parameters #\n######################\n#\n# Change in the file plotdefs.pm for text and limits\n#\n# PS : Mslp\n# TT : T2m\n# TTHA : T2m, adjusted for model and observation station height differences\n# TN : Min T2m\n# TX : Max T2m\n# TD : Td2m\n# FF : Wind speed\n# FX : Max wind speed\n# GG : Wind gust\n# GX : Max wind gust\n# DD : Wind direction\n# QQ : Specific humidity\n# RH : Relative humidity\n# PE : Precipitation\n# NN : Total Cloud cover\n# VI : Visibility, not in vfld files yet\n#\n\n# Active parameters\nSURFPAR=\"PS FF FX GG GX DD TT TN TX TD RH QQ NN PE\"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Note that not all parameters are available in the vfld files for HARMONIE yet. The number of levels to be used for TEMP is set in LEV_LST.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Comment in the code fldextr_pp.f explains TTHA, the moist adiabatic adjustment:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"c adiabatic height correction of station values\nc T2M_corr=T2M+[(STATION_HEIGHT-MODEL_HEIGHT)*ADIABATIC_LAPSE_RATE]\nc ex: STATION_HEIGHT = 400 masl; MODEL_HEIGHT = 500 masl T2M = 10\nc     T2M_corr=10+(400-500)*(-0.0065)=10+0.6=10.6","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"By setting SURFPLOT and TEMPPLOT we choose what kind of statistics we would like to produce. ","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Things to plot:\n# GEN    : General forcast length statistics\n# TIME   : Timeserie statistics\n# SCAT   : Scatterplot\n# MAP    : Bias maps\n# FREQ   : Frequency plots\n# DAYVAR : Daily variation\n# XML    : Station statistics in xml format\n# CONT   : Contingency tables\n# VERT   : Vertical profiles only available for TEMP data\n# SEAS   : Seasonal cycle\n#\nSURFPLOT=\"GEN TIME MAP FREQ SCAT CONT XML DAYVAR\"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"From the contingency tables we are also able to produce a number of skill scores either defined by their classes or thresholds.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"# Select skill scores to be plotted if CONT is activated in SURFPLOT\n# Frequency     : Frequency\n# Frequencybias : Frequency bias\n# POD           : Probability of detection ( hit rate )\n# FAR           : False alarm ratio\n# FA            : False alarm rate\n# TS            : Threath score\n# WILSON        : Wilson diagram, a combination of POD, TS, FAR and frequency bias\n# KSS           : Hansen-Kupiers skill score\n# AI            : Area index\n# EDS           : Extreme Dependency Score\n# SEDS          : Symmetric Extreme Dependency Score\n# EDI           : Extremal Dependency Index\n# SEDI          : Symmetric Extremal Dependency Index\n# ETS           : Equitable threat score\n\nSCORELIST=\"WILSON KSS Frequency\"\n\n# Select whether skill scores are based on classes and/or thresholds (CONT must be activated)\nSCORETYPES=\"classes thresholds\"","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The meaning of the different abbreviations will be given in next section.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"A selection of data is done by SURFSELECTION and TEMPSELECTION. The name in these list refers to definitions in selection.pm. We also select time and forecast interval by the OBINT, FCINT and FCLEN parameters.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"At the end you would possibly like to change the graphics format of the output files.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"#####################\n# GRAPHICS and misc #\n#####################\n\n# Select output_type\n# 1  Postscript + PNG\n# 2  PNG\n# 3  JPEG\n# 4  SVG\nOUTPUT_TYPE=2","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The difference between the first OUTPUT_TYPE and the others is that in the first case gnuplot will produce postscript files that will be converted to PNG files and both files will be available on the web page. The SVG format (Scalable Vector Graphics) should allow plots with zoom functionality, but this does not yet work in the web interface. ","category":"page"},{"location":"#Setting-parameters-for-different-types-of-plots-1","page":"Monitor","title":"Setting parameters for different types of plots","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"If the settings in the main configuration file does not cover your needs you go to next level of the definition files. The namelists defining your verification run is build by Build_namelist.pl by using your configuration file and three perl modules defining different parts. The logics behind the GEN, MAP, TIME switches are hidden in maindefs.pm. The first part defines the reading part:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"%nameread=(\n 'read_section' => {\n    'SDATE'   => $ENV{SDATE},\n    'EDATE'   => $ENV{EDATE},\n    'NEXP'    => $nexp,\n    'EXPNAME' => $exp,\n    'MODPATH' => $modpath,\n    'OBSPATH' => '\\''.$ENV{OBSPATH}.'\\'',\n    'LQUALITY_CONTROL' => 'T',\n    'ESTIMATE_QC_LIMIT'=> 'T',\n    'MAXSTN'           => 5000,\n    'STNLIST'          => 0,\n    'STNLIST_PLOT'     => $ENV{STNLIST_PLOT},\n    'LVERIFY'          => 'F',\n    'PRINT_READ'       => 1,\n    'PERIOD_TYPE'      => $ENV{PERIOD_TYPE},\n    'OUTPUT_TYPE'      => $ENV{OUTPUT_TYPE},\n    'OUTPUT_MODE'      => 2,\n },\n) ;","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Any new variable added here will also be set in the reading part of the namelist. The next part, def, defines values that are reset every time we loop through the verification and reads a new namelist. In the selectionloop part  we find the magic switches for the different SURFPLOT/TEMPPLOT keywords. The first one SEAS is only interesting if you run with a few parameters over several seasons. In the normal case several years of data doesn't fit in the memory so this is left for the experienced user.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The next one is GEN:","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'GEN' => {\n # Fclen plots\n 'LSTAT_GEN'  => 'T',\n 'LSIGN_TEST' => 'T',\n 'SIGN_TIME_DIFF' => '-1',\n 'LPLOT_STAT' => 'T',\n 'SHOW_BIAS' => 'T',\n 'SHOW_RMSE' => 'T',\n 'SHOW_VAR'  => 'T',\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Here we set things for standard forecast length verification. We can choose to show bias, rmse and stdv by the SHOW_* variable. If SHOW_VAR is set plots comparing the model variability to the observed one will be produced. The significance of the difference between different experiments can be shown by setting LSIGN_TEST.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The next section handles the production of bias maps","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'MAP' => {\n # Map plots\n 'PLOT_BIAS_MAP' => 'T',\n 'PLOT_RMSE_MAP' => 'T',\n 'LSTAT_GEN'     => 'T',\n 'LPLOT_STAT'    => 'F',\n 'LFCVER'        => 'F',\n 'SHOW_TIMES'    => '00,12',\n 'USE_FCLEN' => join(',',split(' ',$ENV{FCLEN_MAP})),\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Here we can show decide to show any of bias,rmse and stdv maps. The bias intervals for a given parameter are defined in plotdefs.pm discussed later. Here we have chosen to show only the 00 and 12 UTC maps.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Time serie statistics of the observed values and departures are produced by the TIME section.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'TIME' => {\n  # Timeseries\n  'LTIMESERIE_STAT'=> 'T',\n  'USE_FCLEN' => join(',',split(' ',$ENV{FCLEN_TIME})),\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Note that we explicitly set the forecast lengths we use. As for the GEN part the activation of bias, rmse and stdv plots are controlled by the SHOW_* parameters. The averaging period for time series are controlled per variable through the TWIND_SURF and TWIND_TEMP parameters in plotdefs.pm.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Scatter plots and contingency tables are set in","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'scat_ver' => {\n  # Scatterplots and freq,\n  'LPREP_XML' => 'T',\n  'LPLOT_FREQ'=> 'T',\n  'LPLOT_SCAT'=> 'T',\n  'USE_FCLEN' => join(',',split(' ',$ENV{FCLEN_SCAT})),\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"By setting LPREP_XML we will get a list of stations sorted by decreasing rmse on the web page. This allows you to find the worst stations for different variables. The contingency part of this is defined in plotdefs.pm. It is possible to create cross variable scatter plots where we compare different model parameters against each other or the observations. This is however not a part of the script system but be defined on the low level. Read more in here.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"In some cases it's interesting to see how the model handles the daily cycle. In DAYVAR we define the flags to get this. The LFCVER tell the program that we should organize the statistics by time of day rather than by forecast length. We have also chosen to allow for a special set of forecast length here through the environment variable FCLEN_DAYVAR set in your configuration file","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'DAYVAR' => {\n  # Daily variation\n  'LPLOT_STAT' => 'T',\n  'LSTAT_GEN'  => 'T',\n  'LFCVER'     => 'F',\n  'USE_FCLEN'  => join(',',split(' ',$ENV{FCLEN_DAYVAR})),\n  'SHOW_OBS'   => 'T',\n  'SHOW_VAR'   => 'F',\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The final part of maindefs.pm deals with the vertical profiles. LPLOT_VERT is the flag telling us that we are doing a vertical profile. The major difference between this and GEN is that here we have chosen to split between night and daytime soundings by setting SHOW_TIMES.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Any valid namelist variable added to these sections will be picked up and used in the verification. ","category":"page"},{"location":"#Settings-for-different-meteorological-parameters-1","page":"Monitor","title":"Settings for different meteorological parameters","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"The different treatment of the different meteorological variables are done in plotdefs.pm. In the first section we define the default values for all variables.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'def'=>{\n   'TWIND_SURF' => 06,\n   'TWIND_TEMP' => 12,\n   'QC_LIM_SCALE' => 5.,\n   'MAP_BIAS_INTERVAL'=> '7*-1',\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"The TWIND_* parameter sets the time averaging window for time series for surface data and temp respectively. QC_LIM_SCALE is the scaling factor for the stdv used in the quality control. The TEXT variables sets the text for the title in the plots and the web page. For e.g. the cloud cover we have defined the classes for the contingency tables by setting CONT_CLASS and CONT_LIM. MAP_BIAS_INTERVAL set, as the name indicates, the intervals for the bias maps.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"'NN'=>{\n   'TEXT'        => 'Cloud cover',\n   'CONT_CLASS'  => 7,\n   'CONT_LIM'    => '1.,2.,3.,4.,5.,6.,7.',\n   'PRE_FCLA'    => '1.,2.,3.,4.,5.,6.,7.',\n   'MAP_BIAS_INTERVAL'=> '-6.,-4.,-2.,0.,2.,4.,6.',\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"It is also possible to set the time window for timeseries separately for each variables like it is done for e.g. precipitation (PE). For accumulated and max/min parameters we also need to set the accumulation period. E.g. the maximum temperature for the past 12 hours is defined as","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'TX'=>{\n   'TWIND_SURF'  => 12,\n   'TEXT'        => 'Max T2m',\n   'MAP_BIAS_INTERVAL'=> '-6.,-4.,-2.,0.,2.,4.,6.',\n   'ACC'         => 12,\n   'ACCTYPE'     => 3,\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Where ACCTYPE defines if it's an accumulated (1), minimum (2) or maximum (3)  parameter.","category":"page"},{"location":"#Defining-a-new-verification-parameter-1","page":"Monitor","title":"Defining a new verification parameter","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"As described in the [#Ageneralinputformat input format] section you can add any variable to the verification. Let's say you would like to verify precipiation accunulated over three hours and that you have called it PE3H in your data files.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'PE3H'=>{\n   'TEXT' => 'Precipitation 3h',\n   'ACC'  => 3,\n   'UNIT' => 'mm/3h',\n },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Where TEXT is the description to be displayed on the plot and the webpage, ACC is the accumulation period in hours and UNIT is the unit to be written to the plot. Of course the above mentioned properties can be set as well. Remember to add PE3H to the SURFPAR list in your definition file.","category":"page"},{"location":"#Selection-options-1","page":"Monitor","title":"Selection options","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"It easy to select a subset of your data for verification and we have already discussed how it can be done by setting a list of stations or select different forecast lengths. In selection.pm a number of different kind of selections have been defined. Several of them are just a list of stations like e.g. the well known (but perhaps not so well defined) EWGLAM list. An example of how a box can be defined is found for the Netherlands.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'Netherland' => {\n   'CBOX%ACTIVE' => 'T',\n   'CBOX%SLAT' => '51.',\n   'CBOX%WLON' => '1.5',\n   'CBOX%NLAT' => '54.5',\n   'CBOX%ELON' => '9.',\n   }","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"We may also define our area of selection through a polygon.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":" 'BalticSea' => {\n   'STNLIST'=> 0,\n   'LPOLY'               => 'T',\n   'POLYFILE'            => '\\'Baltic_sea.poly\\'',\n   },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"A more specialized case is the selection of stations by station height where the upper and lower limits are given.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"  'masl_300m' => {\n   'STNLIST'=> 0,\n   'LSTN_HGT_CHECK'=>'.T.',\n   'HGT_ULIM'=>1.e6,\n   'HGT_LLIM'=>300.,\n   },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"Finally we can also do the selection based on meteorological criteria. In the example below we are interested in cases with low temperatures and weak winds.","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"  'temp_and_wind_limit' => {\n    'COND%IND' => 'FF,TT',\n    'COND%ULIM' => ' 5.,-10.',\n    'COND%LLIM' => '-1.,-55.',\n    'COND%LOBS' => 'T,F',\n    'COND%ALL_MOD' => 'T,F',\n  },","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"(Image: )","category":"page"},{"location":"#Example-of-conditional-selection-1","page":"Monitor","title":"Example of conditional selection","text":"","category":"section"},{"location":"#","page":"Monitor","title":"Monitor","text":"COND%IND sets the parameters\nCOND%LLIM sets the lower limits\nCOND%ULIM sets the upper limits\nCOND%LOBS T means apply condition on observations, F applies condition on model data\nCOND%ALL_MOD, T means condition is required for ALL models, F for ANY model","category":"page"},{"location":"#","page":"Monitor","title":"Monitor","text":"All the above mentioned selections can of course be combined in any way you can imagine.","category":"page"}]
}
